---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: oauth2-proxy
  namespace: flux-system
spec:
  interval: 1m
  timeout: 10m
  targetNamespace: capsule-systen
  releaseName: "oauth2-proxy"
  chart:
    spec:
      chart: oauth2-proxy
      version: "7.11.2"
      sourceRef:
        kind: HelmRepository
        name: oauth2-proxy
      interval: 24h
  install:
    remediation:
      retries: -1
  upgrade:
    remediation:
      retries: -1
  driftDetection:
    mode: enabled
  values:
    extraArgs:
    - --upstream=http://grafana.observability-system.svc.cluster.local:80
    - --cookie-name=grafana_oauth2_proxy
    - --proxy-prefix=/oauth
    - --ping-path=/oauth/healthy
    - --silence-ping-logging=true
    - --reverse-proxy=true
    - --skip-provider-button=true
    - --pass-user-headers=true
    - --skip-auth-route="/api/health"
    ingress:
      enabled: false
    livenessProbe:
      enabled: false
    readinessProbe:
      enabled: false
    securityContext:
      fsGroup: 2000
    htpasswdFile:
      enabled: true
      entries:
      - "alice:$2y$05$Xw/FyWKA/DSiTEsPC9GoA.wQ1anlI09CP.eTrU2lQozPjXqvJ.Tce"
      - "bob:$2y$05$ix22yIz/VQMgpLWFxluxqOc8Qvq57HFSap8JPcQbMhkI4ogJMpKKG"
      - "john:$2y$05$rgC8qSRCyZVaKBpuIuHKeOJDXHnVV.EWvRJENGO0bPjHfmnBh7/Sq"
---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: oauth2-proxy
  namespace: flux-system
spec:
  interval: 24h0m0s
  url: https://oauth2-proxy.github.io/manifests